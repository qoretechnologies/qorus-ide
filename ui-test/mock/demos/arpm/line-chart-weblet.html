<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <style type="text/css">
    </style>
  </head>
  <body>
    <div class="ct-chart"></div>
    <script type="text/javascript">
      function isObject(val) {
        if (val === null) { return false;}
        return (typeof val === 'object');
      }
      var srcEvents = $events;
      console.log("srcEvents: " + srcEvents);
      var chartEvents = [];
      var chartLabels = [];
      var chartSeriesData = {};
      for (var index in srcEvents) {
        var item = srcEvents[index];

        if (!isObject(item)) {
          console.log("skipping item cause it is not an object");
          console.log("item: " + item);
          continue;
        }
        if (!item.hasOwnProperty('date')) {
          console.log("skipping item cause it does not have date property");
          continue;
        }
        if (!item.hasOwnProperty('name')) {
          console.log("skipping item cause it does not have name property");
          continue;
        }
        if (!item.hasOwnProperty('description')) {
          console.log("skipping item cause it does not have description property");
          continue;
        }
        if (typeof item.description !== 'string') {
          console.log("skipping item cause it's description property is not a string");
          continue;
        }

        var data = JSON.parse(item.description);
        if (!isObject(data)) {
          console.log("skipping item cause it's data is invalid");
          continue;
        }
        if (!data.hasOwnProperty('values')) {
          console.log("skipping item cause data.values property is missing");
          continue;
        }
        if (!data.hasOwnProperty('orig')) {
          console.log("skipping item cause data.orig property is missing");
          continue;
        }
        if (!isObject(data.values)) {
          console.log("skipping item cause it's data.values property is not an object");
          continue;
        }
        for (var metric in data.values) {
          var val = data.values[metric];
          if (chartSeriesData.hasOwnProperty(metric)) {
            chartSeriesData[metric].push(val);
          }
          else {
            chartSeriesData[metric] = [val];
          }
        }
        chartLabels.push(item.date);
        console.log("chartLabels: " + chartLabels);
        console.log("chartSeriesData: " + chartSeriesData);
      }
      var chartSeries = [];
      for (var key in chartSeriesData) {
        console.log("concat: " + key);
        console.log(chartSeriesData[key]);
        if (chartSeriesData.hasOwnProperty(key)) {
          chartSeries.push(chartSeriesData[key]);
        }
      }
      console.log("chartSeries:");
      console.log(chartSeries);
      console.log("chartLabels:");
      console.log(chartLabels);
      new Chartist.Line('.ct-chart', {
          labels: chartLabels,
          series: chartSeries
        }, {
          fullWidth: true,
          chartPadding: {
            right: 40
          },
          height: '350px'
        }
      );
    </script>
  </body>
</html>