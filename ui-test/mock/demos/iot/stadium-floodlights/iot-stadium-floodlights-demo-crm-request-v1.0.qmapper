# -*- mode: qore; indent-tabs-mode: nil -*-

# name: iot-stadium-floodlights-demo-crm-request
# version: 1.0
# desc: maps IoT stadium light change requests to CRM ticket REST request
# type: Mapper
# author: Qore Technologies, s.r.o.
# parse-options: PO_NEW_STYLE
# define-group: iot-demo: IoT demo interfaces
# groups: iot-demo

OPTION: input: (
    "static": {
        "desc": "static data",
    },
    "context":  {
        "desc": "current execution context info",
    },
)

OPTION: output: (
    "ticket": {
        "type": "hash",
        "desc": "zendesk ticket object",
    },
    "audit": {
        "type": "hash",
        "desc": "zendesk audit object",
    },
)

FIELD: ticket: {
    "name": "static",
    "code": hash<auto> sub (hash<auto> staticdata, hash<auto> rec) {
        return {
            "subject": "STADIUM FLOODLIGHT BULB REPLACEMENT",
            "comment": {
                "body": sprintf("Order new bulb for bulb to replace old with id=%y at stadium with id=%y",
                    staticdata.input_data.device_id, staticdata.input_data.stadium_id),
            },
            "priority": "normal",
            "external_id": rec."context".workflow_instanceid,
            "status": "open",
            "type": "task",
        };
    }
}
# END
